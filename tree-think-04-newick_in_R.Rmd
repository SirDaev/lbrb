---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Plotting trees from Newick notation in R

In R, a phylogenetic tree in Newick format can be input as a character string and plotted using the ape package.

## Preliminaries 

```{r}
library(ape)
library(phangorn)
```

## Note

Throughout this lesson I use the `par()` command to set up plots.  You can ignore this command because its pretty tricky to use.

## 3 taxa tree in Newick

We input the tree as quoted text; note the semi colon at the end!

```{r}
# two taxa in clade
"(H,C)"

# third taxa
"( (H,C) , G )"

# full string
str1 <- "((H, C), G );" # semi colon!
```

We then convert the tree using `read.tree()`
```{r}
tree1 <-ape::read.tree(text=str1)
```

We plot with `plot()`
```{r}
plot(tree1, main = "3-taxa tree")
```


We can change the orientation of the tree by changing the order within the parentheses.  For example, if we want Gorillas to appear at the bottom of the graph

```{r}
str2<- "(G,(H, C));"         # semi colon!
tree2 <-read.tree(text=str2)
plot(tree2, main = "3-taxa tree")
```


Perhaps we want humans at the top
```{r}
str3<- "(G,(C, H));"           # semi colon!
tree3 <-read.tree(text=str3)
plot(tree3, main = "3-taxa tree")
```


Note that all of these trees have the same **branching order** and therefore the exact same **topology**.  

**Challenge:** Try to add the forth possible format of the tree that has the same topology.

TODO doesnt render
```{r , fig.height = 3, fig.width = 5, eval = F}
par(mfrow = c(2,2))
plot(tree1, main = "3-taxa tree 1")
plot(tree2, main = "3-taxa tree 2")
plot(tree3, main = "3-taxa tree 3")
```



## 4 taxa tree in Newick

When there are four taxa, there are two main topologies.  The first is a simple **ladder branching** typology.  This is represented like this
```{r}
str4<- "(((Human, Chimp),Gorilla), Orangutan);"
tree4 <-read.tree(text=str4)

par(mfrow = c(1,1), mar = c(2,2,2,2))
plot(tree4, main = "4-taxa ladder tree")

```

The second major topology is when there are *two* major clades, each with two taxa
```{r}
str5<- "((Human, Chimp), (Gorilla-W, Gorilla-E));"
tree5 <-read.tree(text=str5)
plot(tree5, main = "4-taxa, 2 clade tree")

```

Within each of the topologies, the grouping of species can be switched depending on what the evidence suggests.  For example, some researchers have proposed the humans are more closely related to Orangutans.  Their hypothesis has a **ladder branching** typology with the order of the species switched.


```{r}
str6<- "(((Human, Orangutan),Chimp), Gorilla);"
tree6 <-read.tree(text=str6)
plot(tree6, main = "")
```


## 5 taxa in Newick Format

Five taxa can occur in a number of general typologies.  The most basic is a continuous ladder.  After Orangutans, humans next-most distantly related "cousin" are the Gibbons.  

```{r}
par(mfrow = c(1,1), mar = c(2,2,2,2))
str7<- "((((Human, Chimp),Gorilla), Orangutan),Gibbons);"
tree7 <-read.tree(text=str7)
plot(tree7, main = "5-taxa ladder tree")
```


Let's say there's a hypothesis that Gibbons and Orangutans form a clade (there's no actual evidence of this). This typology would create a tree with two main clades, one with 3 species and one with two.

```{r}
str8 <- "((((Human, Chimp),Gorilla), (Orangutan,Gibbons)));"
tree8 <-read.tree(text=str8)
plot(tree8, main = "5-taxa, 2 big clades tree")
```


A third major typology occurs if there are four taxa in a clade on a branch.  Let's say there's a hypothesis that Orangutans and Gorillas are sister species (they aren't), and Gibbons are there more distantly related cousins.
```{r}

str9 <- "(((Human, Chimp), (Orangutan, Gorilla)), Gibbons);"
tree9 <-read.tree(text=str9)
plot(tree9, main = "5-taxa, with 4-taxa clade ")
```



Here's another example of this format, dropping Gibbons and adding the two Gorilla subspecies (unlike many of the previous examples, this one is true).

```{r}
str10<- "(((Human, Chimp),(Gorilla-W, Gorilla-E)), Orangutan);"
tree10 <-read.tree(text=str10)
plot(tree9, main = "")
```



## Many-taxa tree

Newick format can be used to represent any kind of tree, though in practice this can be very difficult to write out by hand.  Here is an example of a number of vertebrates

```{r}
par(mfrow = c(1,1), mar = c(2,2,2,2))
str.vert<-    "(((((((cow, pig),whale),(bat,(lemur,human))),(robin,iguana)),coelacanth),gold_fish),shark);"
vert.tree<-read.tree(text=str.vert)
plot(vert.tree,no.margin=TRUE,edge.width=2)
```


## Newick and Branch lengths

Below is an example of a BIG tree which also has branch lengths represented.  The original analysis was in  Miyamoto and Goodman (1986) "Biomolecular Systematics of Eutherian Mammals: Phylogenetic Patterns and Classification."
```{r}
str.vert<-  "(Edentata:55, (((Orycteropus:12, Trichechus:43):1, (Procavia:29, (Elephas:18, Loxodonta:5):55):10):15, (((Chiroptera:27, (Tupaia:43, ((Talpa:24, (Suncus:24, Erinaceus:58):6):4, (Manis:5, ((Felis:13, Leo:7):32, ((Canis:37, Ursidae:12):4, ((Phocidae:19, Zalophus:17):7, (Procyonidae:12, Mustelidae:22):9):5):17):13):3):10):6):8, (((Lemuridae:46, (Galago:16, Nycticebus:27):10):8, (Tarsius:15, ((Cebus:10, (Atelinae:5, (Aotus:6, Callithrix:9):3):3):18, ((Hylobates:6, (Pongo:1, (Gorilla:2, (Homo:22, Pan:1):2):6):2):5, (Presbytis:1, (Cercopithecus:1, (Erythrocebus:0, ('Macaca fascicularis':2, ('Macaca mulatta':5, 'Macaca fuscata':0):1, (Theropithecus:2, Papio:4):15):2):1):8):6):9):22):10):13, ((Ochotona:7, Oryctolagus:54):4, (Caviomorpha:107, (Spermophilus:29, (Spalax:23, ((Rattus:71, Mus:19):15, (Ondatra:27, Mesocricetus:32):27):20):8):12):15):11):9):12, ((Sus:50, ((Lama:10, Camelus:24):31, (Hippopotamus:31, (((Ovis:9, Capra:8):19, ((Antilocapra:13, Giraffa:14):7, (Cervus:8, Alces:9):11):2):9, (Tragelaphinae:6, ('Bos grunniens':6, (Bison:5, 'Bos taurus':15):7):11):6):47):10):19):18, ((('Equus (Asinus)':6, 'Equus caballus':31):24, (Tapirus:19, Rhinocerotidae:23):11):22, ((Phocoena:4, Tursiops:17):5, (Balaenoptera:36, Eschrichtius:2):8):29):12):12):16):55);"
vert.tree<-read.tree(text=str.vert)
plot(vert.tree,no.margin=TRUE,edge.width=2)
```



## Additional Reading

The Wikipedia article on Newick format shows how it can be extended for more complex scenarios, including annotation of branch lengths.
https://en.wikipedia.org/wiki/Newick_format

Newick format is briefly mentioned on page 47 of Baum & Smith Tree Thinking.

